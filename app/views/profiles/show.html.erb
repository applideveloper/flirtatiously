<% content_for :right_col do %>
<!-- replacement for draggggable bar -->

<% end %>

<!-- yield head -->

<h1 class="username">
  <%= @profile.user.username %>
</h1>

<%= age(@profile.birthday) %> years old | <%= "#{@profile["sexual_orientation"]} " %><%= @profile["sex"] %> | <%= @profile.city %>
<br>

<% unless @is_current_user_profile %>
  <% percentages = current_user.calculate_percentages(@profile.user) %>
  <%= print_percentages(percentages) %>
  <% end %>
<br>

<%= image_tag(@profile.big_photo.url, :class => "photo-thumbnail") if @profile.big_photo.exists? %> <%= image_tag(@profile.big_photo.url, :class => "photo-thumbnail") if @profile.big_photo.exists? %>
<br>
<%# height later %>

<table class="profile-stats">
<% ["body_type", "smokes", "drugs", "religion"].each do |descriptor| %>

<tr>
  <th><%= descriptor.gsub(/_/," ").capitalize %></th>
  <td> <%= (@profile[descriptor].nil?) ? "--" : @profile[descriptor] %></td>
</tr>

<% end %>
</table>

<%= @profile["likes"] %>

<% unless @is_current_user_profile %>
<% if current_user.likes?(@profile.user) %>
	<% if @profile.user.likes?(current_user) %>
	<b> You guys both like each other!</b>
	<% else %>
	<b> You've liked this user already. Let's hope they like you back. </b>
	<% end %>
<% else %>
<br>
<%= button_to "Like User", like_user_url(@profile.user_id), {method: :post} %>

<div class=""><input type="submit" class="message" value="MESSAGE A BROTHA"></div>
<% end %>
<% end %>

<br>



<br>

<div class="profile-field">
  <span class="editable" name="profile[description]">
    <%= @profile.description %>fdsfds
  </span>
</div>

<% if @is_current_user_profile %>
<script>
$(document).ready(function() {
  $('.profile-field').on('click', '.editable', function(event) {
    var $text = $(event.currentTarget);

    var $profileField = $(event.target).closest('.profile-field')


    var inputValue = $text.html();
    var inputName = $text.attr("name");

    $profileField.html("<textarea class=\"editing\" name=\"" + inputName + "\">" + inputValue + "</textarea>");
  });

  $('.profile-field').on('blur', '.editing', function(event) {
    var $inputField = $(this);
    var $profileField = $(this).closest('.profile-field');
    var paramsName = $(this).attr("name");
    var paramsValue = $(this).val();

    var formData = $(this).serializeJSON();
    console.log(formData);
    var $that = $(this);
    $.ajax({
            url: "<%= profile_url(@profile.id) %>", //will cause trouble?
            type: "PUT",
            data: formData,
            dataType: "json",
            success: function (response) {
              console.log($profileField);
              console.log($that);
              console.log(response);
              console.log("Your callback here!");
              $profileField.html("<span class=\"editable\" name=\"" + $that.attr("name") + "\">" + $that.val() + "</span>");
            },
            error: function(response) {
              console.log("error");
            }
          });
  });
});

</script>
<% else %>
<script>
$(document).ready(function() {

  $('.send-message').on('submit',function(event) {
    event.preventDefault();

    var formData = $(this).serializeJSON();
    console.log("<%= user_messages_url(@profile.user.id) %>");
    console.log("Right before ajax call");
    console.log(formData);
    console.log(this);
    $.ajax({
            url: "<%= user_messages_url(@profile.user.id) %>", //will cause trouble?
            type: "POST",
            data: formData,
            dataType: "json",
            success: function (response) {
              console.log(response);
              console.log("Your callback here!");
              $('.hide-container').toggleClass("unhide");
            },
            error: function(response) {
              console.log("error");
              console.log(response);
            }
          });



  });


  $( ".message" ).click(function(event) {
    event.preventDefault();
    $('.hide-container').toggleClass("unhide");
  });


});
</script>

<script>
$( ".send-message" ).draggable({
  containment: $('content'),
  stop: function(event, ui) {
    console.log(event);
    console.log(ui);
  }
});
</script>


<% end %>











<h3>Questions:</h3>

<% if @is_current_user_profile %>





<% else %>

<%= "This person has not answered any questions." if @other_user_responses.length == 0 %>

<% @other_user_responses.each do |other_response| %>
<p>
<%= other_response.question_text %><br>

<% current_user_response = find_response(other_response.question_id, @current_user_responses) %>

<% if current_user_response.nil? %>

Answer question <%= other_response.question_id %> to see their answer.

<% else %>


<%= (@profile["sex"] == "Male") ? "His" : "Her" %> response: <span class="<%= "unacceptable-resp" if is_unacceptable?(other_response, @current_user_acceptables) %>"><%= other_response.answer_text%> </span>
<br>
Your response:

<span class="<%= "unacceptable-resp" if is_unacceptable?(current_user_response, @other_user_acceptables) %>"><%= current_user_response.answer_text %></span>

<% end %>

<% end %>

<% end %>

<div class="hide-container">

<form class="send-message">
  <%= auth_token_input %>
  <textarea name="message[body]">Type some stuff here</textarea>
  <input type="submit" class="submit-message" value="Submit or close">

</form>

</div>

<br>



