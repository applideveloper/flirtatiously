<% if @random_question.nil? %>
You've answered all the questions.

<% else %>
<form action="<%= question_answer_url(@random_question) %>" method="post">
  <%= auth_token_input %>
  <%= @random_question.text %><br>
  <% @random_question.answer_choices.each do |answer_choice| %>
  <input type="hidden" name="response[question_id]" value="<%= @random_question.id %>">
  <label><input type="radio" name="response[answer_choice_id]" id="answer_answer_choice_id" value="<%= answer_choice.id %>"><%= answer_choice.text %></label><br>
  <!-- need to add user_id and question_id -->
  <% end %>
  <br>
  What you prefer on match:
  <br>
  <% @random_question.answer_choices.each_with_index do |answer_choice, index| %>
  <input type="checkbox" name="acceptable_response[<%= index %>][answer_choice_id]" value="<%= answer_choice.id %>"><%= answer_choice.text%></label><br>

  <% end %>

  <br>
  How important is this to you?
  <br>
  <!-- <input type="hidden" name="all_acceptable_response[question_id]" value="<%= @random_question.id %>"> -->
  <label><input type="radio" name="all_acceptable_response[importance]" value="0" checked>Irrelevant</label><br>
  <label><input type="radio" name="all_acceptable_response[importance]" value="1">A little important</label><br>
  <label><input type="radio" name="all_acceptable_response[importance]" value="10">Important</label><br>
  <label><input type="radio" name="all_acceptable_response[importance]" value="50">Very important</label><br>
  <label><input type="radio" name="all_acceptable_response[importance]" value="250">Mandatory</label><br>

  <input type="Submit" value="Answer question">
</form>

<% end %>



<hr>

<h1> Answered Questions</h1>
<% if @answered_questions.length == 0 %>

"You have not answered any questions." if
<% else %>



<% @answered_questions.each do |question| %>
  <div class="question-container" data-id="<%= question.question_id %>">
    <%= question.question_text %>
    <br>
    <div class="response-show">
      <a href="#" class="response-answer-text toggle-edit"><%= question.answer_text %></a>
    </div>

    <div class="response-edit">
      <%= render partial: "edit_response", locals: {question: Question.includes([:answer_choices, :acceptable_responses]).where(:id => question.question_id).first} %>
    </div>


</div>
<% end %>
<% end %>

<script>
$('.question-container').on("click", '.toggle-edit', function(event) {
  event.preventDefault();
  var $trigger = $(this);
  var $scope = $trigger.closest("div");
  var $question = $scope.closest(".question-container");
  $question.addClass("edit-on");
});

$('.response-edit').on("submit", "form", function(event) {
  event.preventDefault();

  var formData = $(this).serializeJSON();
  var $question = $(this).closest('.question-container')
  var question_id = $question.attr("data-id")

  $.ajax({
          url: "/questions/" + question_id + "/update_answer",
          type: "PUT",
          data: formData,
          dataType: "json",
          success: function (answer_choice) {
            var $answerText = $question.children('.response-show').children('.response-answer-text')
            $answerText.html(answer_choice.text);
            $('.question-container').removeClass("edit-on");
          },
          error: function(response) {
            console.log("error");
            console.log(response);
          }
        });



})

</script>